\documentclass[border=8pt, multi, tikz]{standalone}
\usepackage{import}
\subimport{../Layers/}{init}
\usetikzlibrary{positioning}
\usetikzlibrary{3d} %for including external image

\newcommand{\copymidarrow}{\tikz \draw[-Stealth,line width=0.8mm,draw={rgb:blue,4;red,1;green,1;black,3}] (-0.3,0) -- ++(0.3,0);}

\begin{document}
\begin{tikzpicture}
\tikzstyle{connection}=[ultra thick,every node/.style={sloped,allow upside down},draw=\edgecolor,opacity=0.7]
\tikzstyle{copyconnection}=[ultra thick,every node/.style={sloped,allow upside down},draw={rgb:blue,4;red,1;green,1;black,3},opacity=0.7]
\tikzstyle{skipconnection}=[thick,every node/.style={sloped,allow upside down},draw=red,opacity=0.7]

% Initial layers
\pic[shift=(0,0,0)] at (0,0,0) {
    Box={
        name=conv1,
        caption=7x7 Conv,
        xlabel={ 64, },
        zlabel=64,
        fill=\ConvColor,
        height=80,
        width=2,
        depth=80
    }
};

\pic[shift=(1,0,0)] at (conv1-east) {
    Box={
        name=pool1,
        caption=3x3 MaxPool,
        fill=\PoolColor,
        opacity=0.5,
        height=40,
        width=1,
        depth=40
    }
};

% Conv2_x blocks (3 blocks)
\pic[shift=(1,0,0)] at (pool1-east) {
    Box={
        name=conv2_1_conv1,
        caption=1x1,
        xlabel={ 64, },
        zlabel=64,
        fill=\ConvColor,
        height=40,
        width=1,
        depth=40
    }
};

\pic[shift=(1,0,0)] at (conv2_1_conv1-east) {
    Box={
        name=conv2_1_conv2,
        caption=3x3,
        xlabel={ 64, },
        zlabel=64,
        fill=\ConvColor,
        height=40,
        width=2,
        depth=40
    }
};

\pic[shift=(1,0,0)] at (conv2_1_conv2-east) {
    Box={
        name=conv2_1_conv3,
        caption=1x1,
        xlabel={ 256, },
        zlabel=256,
        fill=\ConvColor,
        height=40,
        width=1,
        depth=40
    }
};

% Connections for conv2_1
\draw [connection]  (pool1-east) -- node {\midarrow} (conv2_1_conv1-west);
\draw [connection]  (conv2_1_conv1-east) -- node {\midarrow} (conv2_1_conv2-west);
\draw [connection]  (conv2_1_conv2-east) -- node {\midarrow} (conv2_1_conv3-west);

% Skip connection for conv2_1 (with 1x1 conv for dimension matching)
\draw [skipconnection] (pool1-east) -- ++(0,1.5,0) -- ++(4,0,0) -- ++(0,-1.5,0) -- (conv2_1_conv3-west);

\pic[shift=(1,0,0)] at (conv2_1_conv3-east) {
    Box={
        name=conv2_2_conv1,
        caption=1x1,
        xlabel={ 64, },
        zlabel=64,
        fill=\ConvColor,
        height=40,
        width=1,
        depth=40
    }
};

\pic[shift=(1,0,0)] at (conv2_2_conv1-east) {
    Box={
        name=conv2_2_conv2,
        caption=3x3,
        xlabel={ 64, },
        zlabel=64,
        fill=\ConvColor,
        height=40,
        width=2,
        depth=40
    }
};

\pic[shift=(1,0,0)] at (conv2_2_conv2-east) {
    Box={
        name=conv2_2_conv3,
        caption=1x1,
        xlabel={ 256, },
        zlabel=256,
        fill=\ConvColor,
        height=40,
        width=1,
        depth=40
    }
};

% Connections for conv2_2
\draw [connection]  (conv2_1_conv3-east) -- node {\midarrow} (conv2_2_conv1-west);
\draw [connection]  (conv2_2_conv1-east) -- node {\midarrow} (conv2_2_conv2-west);
\draw [connection]  (conv2_2_conv2-east) -- node {\midarrow} (conv2_2_conv3-west);

% Skip connection for conv2_2
\draw [skipconnection] (conv2_1_conv3-east) -- ++(0,1.2,0) -- ++(3,0,0) -- ++(0,-1.2,0) -- (conv2_2_conv3-west);

\pic[shift=(1,0,0)] at (conv2_2_conv3-east) {
    Box={
        name=conv2_3_conv1,
        caption=1x1,
        xlabel={ 64, },
        zlabel=64,
        fill=\ConvColor,
        height=40,
        width=1,
        depth=40
    }
};

\pic[shift=(1,0,0)] at (conv2_3_conv1-east) {
    Box={
        name=conv2_3_conv2,
        caption=3x3,
        xlabel={ 64, },
        zlabel=64,
        fill=\ConvColor,
        height=40,
        width=2,
        depth=40
    }
};

\pic[shift=(1,0,0)] at (conv2_3_conv2-east) {
    Box={
        name=conv2_3_conv3,
        caption=1x1,
        xlabel={ 256, },
        zlabel=256,
        fill=\ConvColor,
        height=40,
        width=1,
        depth=40
    }
};

% Connections for conv2_3
\draw [connection]  (conv2_2_conv3-east) -- node {\midarrow} (conv2_3_conv1-west);
\draw [connection]  (conv2_3_conv1-east) -- node {\midarrow} (conv2_3_conv2-west);
\draw [connection]  (conv2_3_conv2-east) -- node {\midarrow} (conv2_3_conv3-west);

% Skip connection for conv2_3
\draw [skipconnection] (conv2_2_conv3-east) -- ++(0,1.2,0) -- ++(3,0,0) -- ++(0,-1.2,0) -- (conv2_3_conv3-west);

% Conv3_x blocks (4 blocks) - showing first block with downsample
\pic[shift=(1,0,0)] at (conv2_3_conv3-east) {
    Box={
        name=conv3_1_conv1,
        caption=1x1,
        xlabel={ 128, },
        zlabel=128,
        fill=\ConvColor,
        height=32,
        width=1,
        depth=32
    }
};

\pic[shift=(1,0,0)] at (conv3_1_conv1-east) {
    Box={
        name=conv3_1_conv2,
        caption=3x3,
        xlabel={ 128, },
        zlabel=128,
        fill=\ConvColor,
        height=32,
        width=2,
        depth=32
    }
};

\pic[shift=(1,0,0)] at (conv3_1_conv2-east) {
    Box={
        name=conv3_1_conv3,
        caption=1x1,
        xlabel={ 512, },
        zlabel=512,
        fill=\ConvColor,
        height=32,
        width=1,
        depth=32
    }
};

% Connections for conv3_1
\draw [connection]  (conv2_3_conv3-east) -- node {\midarrow} (conv3_1_conv1-west);
\draw [connection]  (conv3_1_conv1-east) -- node {\midarrow} (conv3_1_conv2-west);
\draw [connection]  (conv3_1_conv2-east) -- node {\midarrow} (conv3_1_conv3-west);

% Skip connection for conv3_1 (with 1x1 conv for dimension matching and stride 2)
\draw [skipconnection] (conv2_3_conv3-east) -- ++(0,1.5,0) -- ++(3,0,0) -- ++(0,-1.5,0) -- (conv3_1_conv3-west);

% Continue with remaining conv3 blocks (abbreviated for space)
\pic[shift=(1,0,0)] at (conv3_1_conv3-east) {
    Box={
        name=conv3_remaining,
        caption=Conv3\_2-4,
        xlabel={ 512, },
        zlabel=512,
        fill=\ConvColor,
        height=32,
        width=3,
        depth=32
    }
};

\draw [connection]  (conv3_1_conv3-east) -- node {\midarrow} (conv3_remaining-west);

% Conv4_x blocks (6 blocks) - abbreviated
\pic[shift=(1,0,0)] at (conv3_remaining-east) {
    Box={
        name=conv4_all,
        caption=Conv4\_1-6,
        xlabel={ 1024, },
        zlabel=1024,
        fill=\ConvColor,
        height=24,
        width=6,
        depth=24
    }
};

\draw [connection]  (conv3_remaining-east) -- node {\midarrow} (conv4_all-west);

% Conv5_x blocks (3 blocks) - abbreviated
\pic[shift=(1,0,0)] at (conv4_all-east) {
    Box={
        name=conv5_all,
        caption=Conv5\_1-3,
        xlabel={ 2048, },
        zlabel=2048,
        fill=\ConvColor,
        height=16,
        width=3,
        depth=16
    }
};

\draw [connection]  (conv4_all-east) -- node {\midarrow} (conv5_all-west);

% Final layers
\pic[shift=(1,0,0)] at (conv5_all-east) {
    Box={
        name=avgpool,
        caption=AvgPool,
        fill=\PoolColor,
        opacity=0.5,
        height=1,
        width=1,
        depth=1
    }
};

\draw [connection]  (conv5_all-east) -- node {\midarrow} (avgpool-west);

\pic[shift=(2,0,0)] at (avgpool-east) {
    Box={
        name=fc,
        caption=FC + Softmax,
        xlabel={" ","dummy"},
        zlabel=1000,
        fill=\SoftmaxColor,
        opacity=0.8,
        height=3,
        width=1.5,
        depth=25
    }
};

\draw [connection]  (avgpool-east) -- node {\midarrow} (fc-west);

\end{tikzpicture}
\end{document}